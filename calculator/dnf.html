<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>메뉴 주문 페이지</title>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    .layout {
      display: flex;
      height: 100vh;
    }

    .menu {
      box-sizing: border-box;
      flex: 0 0 70%;
      border-right: 1px solid #ddd;
      padding: 16px;
      overflow-y: auto;
    }

    .cart {
      box-sizing: border-box;
      flex: 0 0 30%;
      padding: 16px;
      overflow-y: auto;
    }

    h2 {
      top: 0;
      background: #fff;
      padding: 10px 0;
      margin: 0 0 10px;
      border-bottom: 1px solid #eee;
    }

    #menu-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
    }

    .menu .menu-item {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      border: 1px solid #eee;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 1px 2px rgba(0,0,0,0.02);
      margin-bottom: 0;
      overflow: hidden;
    }

    .menu .menu-item .card-body {
      display: flex;
      flex-direction: column;
    }

    .thumb-wrap {
      position: relative;
      width: 100%;
      display: block;
    }

    .menu-thumb {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 6px 6px 0 0;
      background: #f3f3f3;
      display: block;
    }

    .thumb-overlay {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 10px;
      color: #fff;
      background: rgba(0,0,0,0.3);
      box-sizing: border-box;
    }

    .thumb-overlay .name {
      font-weight: 700;
      font-size: 14px;
    }

    .thumb-overlay .price {
      font-size: 13px;
    }

    .qty-control {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      gap: 8px;
      padding: 8px;
      box-sizing: border-box;
    }

    .qty-control .qty {
      flex: 1;
      min-width: 32px;
      text-align: center;
      display: inline-block;
      font-weight: 600;
      font-size: 15px;
    }

    .qty-control button:not(.icon-btn) {
      padding: 8px 14px;
      min-width: 44px;
      font-weight: bold;
      font-size: 16px;
      border-radius: 6px;
      background: #fafafa;
      border: 1px solid #ddd;
      cursor: pointer;
    }

    .qty-control button:active {
      transform: translateY(1px);
    }

    :root {
      --icon-size: 36px;
      --icon-mark-size: 16px;
    }

    .icon-btn {
      position: relative;
      box-sizing: border-box;
      width: var(--icon-size);
      height: var(--icon-size);
      padding: 0;
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      vertical-align: middle;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease;
    }

    .icon-btn:focus {
      outline: 2px solid rgba(56,161,105,0.25);
    }

    .icon-btn::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: var(--icon-mark-size);
      height: 2px;
      background: #333;
      border-radius: 1px;
    }

    .icon-btn.plus::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 2px;
      height: var(--icon-mark-size);
      background: #333;
      border-radius: 1px;
    }

    .menu .menu-item .qty-control {
      align-self: center;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      padding: 8px 0;
    }

    .cart-buttons {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .cart-buttons button {
      flex: 1 1 auto;
      padding: 10px 12px;
      font-weight: 700;
      border-radius: 6px;
      border: 1px solid #2b8a3e;
      background: #38a169;
      color: #fff;
    }

    .cart-buttons button.secondary {
      background: #f5f5f5;
      color: #333;
      border: 1px solid #ddd;
    }

    .history-modal {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    /* History modal controls/buttons */
    .history-controls { display:flex; gap:8px; align-items:center; }
    .history-controls button { padding:8px 12px; border-radius:6px; border:none; background:#2b8a3e; color:#fff; font-weight:700; cursor:pointer; }
    .history-controls button.secondary { background:#f5f5f5; color:#333; border:1px solid #ddd; font-weight:700; }
    .history-controls button:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,0.08); }
    #close-history { margin-left:auto; background:transparent; color:#333; border:1px solid #ddd; padding:6px 10px; }
    #close-history:hover { background:#f3f3f3; }

    /* Custom bank-transfer checkbox */
    .transfer-label { display:flex; align-items:center; gap:8px; cursor:pointer; user-select:none; }
    .transfer-label input[type="checkbox"] { position: absolute; opacity: 0; width: 0; height: 0; }
    .transfer-label .checkmark {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 2px solid #dcdcdc;
      background: linear-gradient(#fff,#fbfbfb);
      box-shadow: 0 1px 2px rgba(0,0,0,0.04) inset;
      display:inline-block;
      flex: 0 0 20px;
      position: relative;
      transition: background .12s ease, border-color .12s ease;
    }
    /* check icon (hidden by default) */
    .transfer-label .checkmark::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%) scale(0.9);
      width: 12px;
      height: 12px;
      /* stroke-based checkmark with ~2px thickness */
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M20 7 L9 18 L4 13' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>");
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0;
      transition: opacity .12s ease, transform .12s ease;
      transform-origin: center;
    }
    /* checked state styles */
    .transfer-label input[type="checkbox"]:checked + .checkmark {
      background: linear-gradient(#2f9a57,#2b8a3e);
      border-color: #2b8a3e;
    }
    .transfer-label input[type="checkbox"]:checked + .checkmark::after {
      opacity: 1;
      transform: translate(-50%,-50%) scale(1);
    }
    /* focus ring for keyboard users */
    .transfer-label input[type="checkbox"]:focus + .checkmark {
      box-shadow: 0 0 0 4px rgba(43,138,62,0.12);
    }
    .transfer-text { font-weight:700; color:#333; }

    .payment-modal {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }

    .payment-modal .panel {
      width: 90%;
      max-width: 420px;
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.12);
    }

    .payment-row { display:flex; align-items:center; gap:8px; margin:8px 0; }
    .payment-row label { width:110px; font-weight:700; }
    .payment-row input { flex:1; padding:8px 10px; border:1px solid #ddd; border-radius:6px; }
    .payment-amount { flex:1; padding:8px 10px; border:1px solid #ddd; border-radius:6px; background:#fff; min-height:36px; display:flex; align-items:center; }
    .payment-error { color:#c53030; font-size:13px; margin-top:6px; }
    .preset-row { display:flex; gap:8px; margin-top:8px; }
    .preset-btn { flex:1; padding:8px 10px; border-radius:6px; border:1px solid #ddd; background:#f3f7f3; cursor:pointer; font-weight:700; }
    .numpad { display:grid; grid-template-columns: repeat(3,1fr); gap:8px; margin-top:10px; }
    .key-btn { padding:12px 0; font-size:16px; border-radius:6px; border:1px solid #ddd; background:#fff; cursor:pointer; }

    .payment-actions { display:flex; gap:8px; margin-top:12px; }
    .payment-actions button { flex:1; padding:10px 12px; font-size:16px; font-weight:800; border-radius:8px; border:1px solid #2b8a3e; background:#38a169; color:#fff; cursor:pointer; }
    .payment-actions button.secondary { background:#f5f5f5; color:#333; border:1px solid #ddd; }

    .history-modal .panel {
      width: 90%;
      max-width: 720px;
      max-height: 80vh;
      overflow: auto;
      background: #fff;
      border-radius: 8px;
      padding: 16px;
    }

    .history-item {
      border-bottom: 1px solid #eee;
      padding: 8px 0;
    }

    .history-item-row { display:flex; justify-content:space-between; gap:12px; align-items:center; }
    .history-item-name { color:#333; }
    .history-item-price { color:#333; font-weight:700; }

    .history-meta {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      font-size: 13px;
      color: #666;
    }
    /* Keep only color for per-order totals and the header total (remove extra styling) */
    .history-meta .order-total {
      color: #2b8a3e;
    }
    #history-total {
      color: #2b8a3e;
    }
  </style>
</head>
<body>

  <div class="layout">
    
    <!-- 좌측 메뉴 -->
    <div class="menu">
      <div id="menu-list"></div>
    </div>

    <!-- 우측 선택한 메뉴 -->
    <div class="cart">
      <h2>계산서</h2>
      <div id="cart-list"></div>
      <hr />
      <h3>총 합계: <span id="total-price">0</span>원</h3>
      <div class="transfer-row" style="margin:8px 0;">
        <label class="transfer-label">
          <input id="bank-transfer" type="checkbox" />
          <span class="checkmark" aria-hidden="true"></span>
          <span class="transfer-text">계좌이체</span>
        </label>
      </div>
      <div class="cart-buttons">
        <button id="purchase-btn">구매하기</button>
        <button id="history-btn" class="secondary">내역보기</button>
      </div>
      <!-- history modal -->
      <div id="history-modal" class="history-modal" aria-hidden="true">
        <div class="panel">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
            <h3 style="margin:0;">구매 내역</h3>
            <div id="history-total" style="margin-left:auto;font-weight:700;">전체 총액: 0원</div>
          </div>
          <div class="history-controls" style="margin-bottom:10px;">
            <button id="export-all" class="secondary">내역 내보내기</button>
            <button id="clear-history" class="secondary">내역 비우기</button>
            <button id="close-history">닫기</button>
          </div>
          <div id="history-list"></div>
        </div>
      </div>
      <!-- payment modal -->
      <div id="payment-modal" class="payment-modal" aria-hidden="true">
        <div class="panel">
          <h3 style="margin-top:0;">결제</h3>
          <div class="payment-row">
            <label>총액</label>
            <div id="payment-total">0원</div>
          </div>
          <div class="payment-row">
            <label for="payment-amount">지불액</label>
            <p id="payment-amount" class="payment-amount" role="textbox" aria-label="지불액">0</p>
          </div>
          <div class="preset-row">
            <button type="button" class="preset-btn" onclick="presetAdd(1000)">+1,000</button>
            <button type="button" class="preset-btn" onclick="presetAdd(5000)">+5,000</button>
            <button type="button" class="preset-btn" onclick="presetAdd(10000)">+10,000</button>
            <button type="button" class="preset-btn" onclick="presetAdd(50000)">+50,000</button>
          </div>
          <div class="numpad" role="group" aria-label="숫자패드">
            <button type="button" class="key-btn" onclick="numpadPress('1')">1</button>
            <button type="button" class="key-btn" onclick="numpadPress('2')">2</button>
            <button type="button" class="key-btn" onclick="numpadPress('3')">3</button>
            <button type="button" class="key-btn" onclick="numpadPress('4')">4</button>
            <button type="button" class="key-btn" onclick="numpadPress('5')">5</button>
            <button type="button" class="key-btn" onclick="numpadPress('6')">6</button>
            <button type="button" class="key-btn" onclick="numpadPress('7')">7</button>
            <button type="button" class="key-btn" onclick="numpadPress('8')">8</button>
            <button type="button" class="key-btn" onclick="numpadPress('9')">9</button>
            <button type="button" class="key-btn" onclick="numpadPress('C')">C</button>
            <button type="button" class="key-btn" onclick="numpadPress('0')">0</button>
            <button type="button" class="key-btn" onclick="numpadPress('←')">←</button>
          </div>
          <div class="payment-row">
            <label>거스름돈</label>
            <div id="payment-change">0원</div>
          </div>
          <div id="payment-error" class="payment-error" aria-live="polite"></div>
          <div class="payment-actions">
            <button id="confirm-payment">확인</button>
            <button id="cancel-payment" class="secondary">취소</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    let menuList = [];
    let cart = {};

    const menuEl = document.getElementById("menu-list");
    const cartEl = document.getElementById("cart-list");
    const totalEl = document.getElementById("total-price");
    // Local storage key for persistent cart
    const CART_KEY = "dnf_cart_v1";
    const ORDERS_KEY = "dnf_orders_v1";

    // Save cart to localStorage
    function saveCartToStorage() {
      try {
        localStorage.setItem(CART_KEY, JSON.stringify(cart));
      } catch (e) {
        console.warn("saveCart failed", e);
      }
    }

    // Load cart from localStorage (if present)
    function loadCartFromStorage() {
      try {
        const raw = localStorage.getItem(CART_KEY);
        if (!raw) return;
        cart = JSON.parse(raw) || {};
      } catch (e) {
        console.warn("loadCart failed", e);
        cart = {};
      }
    }

    // Orders (purchase history)
    let orders = [];
    function saveOrdersToStorage() {
      try {
        localStorage.setItem(ORDERS_KEY, JSON.stringify(orders));
      } catch (e) {
        console.warn('saveOrders failed', e);
      }
    }
    function loadOrdersFromStorage() {
      try {
        const raw = localStorage.getItem(ORDERS_KEY);
        if (!raw) return;
        orders = JSON.parse(raw) || [];
      } catch (e) {
        console.warn('loadOrders failed', e);
        orders = [];
      }
    }

    // CSV 로드
    async function loadCSV() {
      const res = await fetch("menu.csv");
      const text = await res.text();
      parseCSV(text);
      renderMenu();
    }

    // CSV 파싱
    function parseCSV(csv) {
      const lines = csv.trim().split("\n");
      menuList = lines.slice(1).map(line => {
        const [id, name, price] = line.split(",");
        return { id: Number(id), name, price: Number(price) };
      });
    }

    // 메뉴 렌더
    function renderMenu() {
      menuEl.innerHTML = "";
      menuList.forEach(item => {
        const qty = cart[item.id] ? cart[item.id].qty : 0;
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <div class="card-body">
            <div class="thumb-wrap">
              <img class="menu-thumb" src="data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='100%25' height='100%25' fill='%23f3f3f3'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='12' fill='%23666'%3E%EC%98%88%EC%8B%9C%3C/text%3E%3C/svg%3E" alt="예시 이미지" />
              <div class="thumb-overlay">
                <span class="name">${item.name}</span>
                <span class="price">${item.price.toLocaleString()}원</span>
              </div>
            </div>
            <div class="qty-control">
              <span class="qty">${qty}</span>
              <button class="icon-btn minus" onclick="decrease(${item.id})" aria-label="감소"></button>
              <button class="icon-btn plus" onclick="addToCart(${item.id})" aria-label="증가"></button>
            </div>
          </div>
        `;
        menuEl.appendChild(div);
      });
    }

    // 장바구니 렌더
    function renderCart() {
      cartEl.innerHTML = "";

      const items = Object.values(cart);
      if (items.length === 0) {
        cartEl.innerHTML = "<p>선택한 메뉴 없음</p>";
        totalEl.textContent = "0";
        return;
      }

      items.forEach(item => {
        const div = document.createElement("div");
        div.className = "cart-item";
        div.innerHTML = `
          <span>${item.name} x ${item.qty}</span>
          <div>
            <button class="icon-btn minus" onclick="decrease(${item.id})" aria-label="감소"></button>
            <button class="icon-btn plus" onclick="addToCart(${item.id})" aria-label="증가"></button>
          </div>
        `;
        cartEl.appendChild(div);
      });

      const total = items.reduce(
        (sum, item) => sum + item.price * item.qty,
        0
      );
      totalEl.textContent = total.toLocaleString();
    }

    // create an order from current cart, save to orders and trigger download
    function purchase() {
      const items = Object.values(cart).map(i => ({ id: i.id, name: i.name, price: i.price, qty: i.qty }));
      if (items.length === 0) return;
      const total = items.reduce((s, it) => s + it.price * it.qty, 0);
      const btElem = document.getElementById('bank-transfer');
      const bankChecked = !!btElem && btElem.checked;
      if (bankChecked) {
        const ts = new Date().toISOString();
        const order = { id: 'order-' + Date.now(), timestamp: ts, items, total, type: '계좌이체' };
        orders.push(order);
        saveOrdersToStorage();
        cart = {};
        saveCartToStorage();
        renderCart();
        renderMenu();
        if (typeof renderRecentPurchases === 'function') renderRecentPurchases();
        // only clear the checkbox after successful registration
        if (btElem) btElem.checked = false;
        return;
      }
      document.getElementById('payment-total').textContent = total.toLocaleString() + '원';
      document.getElementById('payment-amount').textContent = '0';
      document.getElementById('payment-change').textContent = '0원';
      document.getElementById('payment-error').textContent = '';
      const modal = document.getElementById('payment-modal');
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');
      // focus not applied to <p>; use numpad/preset to enter amount
    }

    function hidePaymentModal() {
      const modal = document.getElementById('payment-modal');
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
    }

    function computeChange() {
      const totalText = document.getElementById('payment-total').textContent.replace(/,/g,'').replace('원','');
      const total = Number(totalText) || 0;
      const paidText = document.getElementById('payment-amount').textContent.replace(/,/g,'').replace('원','');
      const paid = Number(paidText) || 0;
      const change = paid - total;
      const changeEl = document.getElementById('payment-change');
      changeEl.textContent = (change >= 0 ? change.toLocaleString() + '원' : '-' + Math.abs(change).toLocaleString() + '원');
      const err = document.getElementById('payment-error');
      if (paid < total) {
        err.textContent = '지불액이 부족합니다.';
      } else {
        err.textContent = '';
      }
    }

    function numpadPress(key) {
      const el = document.getElementById('payment-amount');
      let s = (el.textContent || '').toString().replace(/,/g,'');
      if (key === 'C') {
        s = '';
      } else if (key === '←') {
        s = s.slice(0, -1);
      } else {
        s = s + key;
      }
      s = s.replace(/^0+(?=\d)/, '');
      el.textContent = s === '' ? '0' : String(Number(s));
      computeChange();
    }

    function presetAdd(amount) {
      const el = document.getElementById('payment-amount');
      let val = Number((el.textContent || '').toString().replace(/,/g,'')) || 0;
      val += Number(amount) || 0;
      el.textContent = String(val);
      computeChange();
    }

    function confirmPayment() {
      const items = Object.values(cart).map(i => ({ id: i.id, name: i.name, price: i.price, qty: i.qty }));
      if (items.length === 0) return;
      const totalText = document.getElementById('payment-total').textContent.replace(/,/g,'').replace('원','');
      const total = Number(totalText) || 0;
      const paidText = document.getElementById('payment-amount').textContent.replace(/,/g,'').replace('원','');
      const paid = Number(paidText) || 0;
      if (paid < total) {
        document.getElementById('payment-error').textContent = '지불액이 부족합니다.';
        return;
      }
      const ts = new Date().toISOString();
      const order = { id: 'order-' + Date.now(), timestamp: ts, items, total, type: '현금구매' };
      orders.push(order);
      saveOrdersToStorage();
      cart = {};
      saveCartToStorage();
      renderCart();
      renderMenu();
      if (typeof renderRecentPurchases === 'function') renderRecentPurchases();
      hidePaymentModal();
      const btElem = document.getElementById('bank-transfer'); if (btElem) btElem.checked = false;
    }

    // History modal functions
    function renderHistoryList() {
      const listEl = document.getElementById('history-list');
      listEl.innerHTML = '';
      // update overall history total
      const totalAll = (orders || []).reduce((s, o) => s + (o.total || 0), 0);
      const historyTotalEl = document.getElementById('history-total');
      if (historyTotalEl) historyTotalEl.textContent = '전체 총액: ' + totalAll.toLocaleString() + '원';
      if (!orders || orders.length === 0) {
        listEl.innerHTML = '<p>저장된 내역이 없습니다.</p>';
        return;
      }
      orders.slice().reverse().forEach(o => {
        const div = document.createElement('div');
        div.className = 'history-item';
        const itemsHtml = o.items.map(it => {
          const lineTotal = (it.price * it.qty).toLocaleString();
          return `<div class="history-item-row"><div class="history-item-name">${it.name} x ${it.qty}</div><div class="history-item-price">${lineTotal}원</div></div>`;
        }).join('');
        div.innerHTML = `
          <div style="margin-top:6px;">${itemsHtml}</div>
          <div class="history-meta" style="margin-top:8px;">
            <div>${(o.type ? '[' + o.type + '] ' : '') + new Date(o.timestamp).toLocaleString()}</div>
            <div>총액 <span class="history-item-price order-total">${o.total.toLocaleString()}원</span></div>
          </div>
        `;
        listEl.appendChild(div);
      });
    }

    function showHistory() {
      const modal = document.getElementById('history-modal');
      renderHistoryList();
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');
    }
    function hideHistory() {
      const modal = document.getElementById('history-modal');
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
    }

    function exportAllHistory() {
      const blob = new Blob([JSON.stringify(orders, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `orders-${Date.now()}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function clearHistory() {
      if (!confirm('정말로 모든 내역을 삭제하시겠습니까?')) return;
      orders = [];
      saveOrdersToStorage();
      renderHistoryList();
    }

    // 추가
    function addToCart(id) {
      const item = menuList.find(m => m.id === id);
      if (!cart[id]) cart[id] = { ...item, qty: 1 };
      else cart[id].qty += 1;
      // update both sides so the menu qty reflects changes
      renderCart();
      renderMenu();
      // persist cart locally
      saveCartToStorage();
    }

    // 감소
    function decrease(id) {
      if (!cart[id]) return;
      if (cart[id].qty > 1) cart[id].qty -= 1;
      else delete cart[id];
      // update both sides so the menu qty reflects changes
      renderCart();
      renderMenu();
      // persist cart locally
      saveCartToStorage();
    }

    // 초기 실행: 먼저 로컬에 저장된 장바구니/내역 불러오기, 그 다음 메뉴 로드
    loadCartFromStorage();
    loadOrdersFromStorage();
    loadCSV();
    // 렌더 카트 한 번 실행해서 복원된 장바구니를 화면에 표시
    renderCart();

    // wire up history & purchase buttons
    document.getElementById('purchase-btn').addEventListener('click', purchase);
    document.getElementById('history-btn').addEventListener('click', showHistory);
    document.getElementById('close-history').addEventListener('click', hideHistory);
    document.getElementById('export-all').addEventListener('click', exportAllHistory);
    document.getElementById('clear-history').addEventListener('click', clearHistory);
    document.getElementById('cancel-payment').addEventListener('click', hidePaymentModal);
    document.getElementById('confirm-payment').addEventListener('click', confirmPayment);
    // hide modal when clicking outside panel
    document.getElementById('history-modal').addEventListener('click', e => {
      if (e.target === e.currentTarget) hideHistory();
    });
  </script>

</body>
</html>
